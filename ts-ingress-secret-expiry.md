---

copyright: 
  years: 2014, 2022
lastupdated: "2022-12-01"

keywords: kubernetes, help, network, connectivity

subcollection: containers

content-type: troubleshoot

---

{{site.data.keyword.attribute-definition-list}}




# Why isn't the Ingress secret expiration date updated?
{: #sync_cert_dates}
{: support}

Supported infrastructure providers
:   Classic
:   VPC


When you run `ibmcloud ks cluster get -c <cluster_name_or_ID>` or `ibmcloud ks ingress status-report get -c <cluster_name_or_ID>`, you see one of the following **Ingress Messages**:
{: tsSymptoms}

```sh
The expiration dates reported by Ingress secrets are out of sync across namespaces. To resynchronize the expiration dates, see http://ibm.biz/ingress-secret-sync
```
{: screen}

```sh
Some certificates have expired or expire within 5 days. See http://ibm.biz/ingress-secret-sync
```
{: screen}

When you run `ibmcloud ks ingress secret ls -c <cluster_name_or_ID>`, you notice that old expiration dates are listed for some certificates.

Sometimes, the expiration date that is reported by the secrets in some namespaces in your cluster can become out of sync with the expiration date of secrets for the same certificate in other namespaces. Even though your actual certificate is renewed, a secret in your cluster can show an older expiration date that is not updated to the most recent expiration date for the certificate.
{: tsCauses}

However, a secret for this certificate in another namespace might show the correct expiration date.

In some other cases the renewal of the certificate may fail. In that case all the relevant secrets on the cluster show an older expiration date.


To fix the expiration dates, complete the following steps.
{: tsResolve}

## If the secret was autogenerated for a network load balancer (NLB) subdomain of your cluster
{: #ts-autogenerated-secret}

If there is no IP address or VPC loadbalancer hostname registered for a subdomain the autogenerated certificate of that subdomain is not renewed automatically. If the subdomain is not in use, remove the secrets of that subdomain with the `ibmcloud ks nlb-dns secret rm` command.
{: important}

1. Get your **Ingress Subdomain**.
    ```sh
    ibmcloud ks cluster get --cluster <cluster_name_or_ID> | grep 'Ingress Subdomain'
    ```
    {: pre}

2. Regenerate the Ingress subdomain secret. The certificate is renewed, a new expiration date is generated, and the updates are synchronized across the secret in different namespaces. Secret regeneration is not disruptive, and traffic continues to flow while the secret regenerates.
    ```sh
    ibmcloud ks nlb-dns secret regenerate -c <cluster_name_or_ID> --nlb-subdomain <ingress_subdomain>
    ```
    {: pre}

    It might take 30 minutes or longer for the secret regeneration to complete.
    {: note}

3. List all the secrets associated with the certificate for your Ingress subdomain. In the output, verify that the **Expiration date** for each is secret is more than 5 days later than the current date.
    ```sh
    ibmcloud ks ingress secret ls -c <cluster_name_or_ID> | grep <ingress_subdomain>
    ```
    {: pre}

    Example output

    ```sh
    Name                                              Namespace        CRN                                                                                                                                                           Expires On                 Domain                                                                                  Status
    mycluster-35366fb2d3d90fd50548180f69e7d12a-0000   default          crn:v1:bluemix:public:cloudcerts:eu-de:a/6ef045fd2b43266cfe8e6388dd2ec098:4ebc1d51-8a74-4675-8c4c-b2922ceba2d4:certificate:70f08c8a0fc1eed1f147b28443ba6dcd   2020-12-10T18:00:58+0000   mycluster-35366fb2d3d90fd50548180f69e7d12a-0000.eu-de.containers.appdomain.cloud     created
    mycluster-35366fb2d3d90fd50548180f69e7d12a-0000   ibm-cert-store   crn:v1:bluemix:public:cloudcerts:eu-de:a/6ef045fd2b43266cfe8e6388dd2ec098:4ebc1d51-8a74-4675-8c4c-b2922ceba2d4:certificate:70f08c8a0fc1eed1f147b28443ba6dcd   2020-12-10T18:00:58+0000   *.mycluster-35366fb2d3d90fd50548180f69e7d12a-0000.eu-de.containers.appdomain.cloud   created
    mycluster-35366fb2d3d90fd50548180f69e7d12a-0000   kube-system      crn:v1:bluemix:public:cloudcerts:eu-de:a/6ef045fd2b43266cfe8e6388dd2ec098:4ebc1d51-8a74-4675-8c4c-b2922ceba2d4:certificate:70f08c8a0fc1eed1f147b28443ba6dcd   2020-12-10T18:00:58+0000   *.mycluster-35366fb2d3d90fd50548180f69e7d12a-0000.eu-de.containers.appdomain.cloud   created
    ```
    {: screen}

4. Optional: Other secrets for network load balancer (NLB) subdomains in your cluster might report expiration dates that are out of sync with the certificate's expiration date. You can run the following steps to resynchronize the expiration dates for other secrets in your cluster

    1. List all NLB subdomains in your cluster.
        ```sh
        ibmcloud ks nlb-dns ls -c <cluster_name_or_ID>
        ```
        {: pre}

    2. For each subdomain besides the Ingress subdomain, regenerate its secret. The certificate is renewed, a new expiration date is generated, and the updates are synchronized across the secret in different namespaces. Secret regeneration is not disruptive, and traffic continues to flow while the secret regenerates. Note that it might take 30 minutes or longer for the secret regeneration to complete.
        ```sh
        ibmcloud ks nlb-dns secret regenerate -c <cluster_name_or_ID> --nlb-subdomain <NLB_DNS_subdomain>
        ```
        {: pre}

    3. List all secrets associated with the certificate for your Ingress subdomain. In the output, verify that the **Expiration date** for the secrets are more than 30 days later than today.
        ```sh
        ibmcloud ks ingress secret ls -c <cluster_name_or_ID> | grep <ingress_subdomain>
        ```
        {: pre}

## If the secret was created from a certificate stored in IBM Cloud Certificate Manager of your cluster
{: #ts-cert-mgr-secret}

1. List the Ingress secrets in your cluster.
    ```sh
    ibmcloud ks ingress secret ls -c <cluster_name_or_ID>
    ```
    {: pre}


2. Update the secret on the cluster with the certificate stored in {{site.data.keyword.cloudcerts_long_notm}}. Repeat this step for each of the expired secrets in all the relevant namespaces. Updating secrets is not disruptive, and traffic continues to flow during the update.
    ```sh
    ibmcloud ks ingress secret update -c <cluster_name_or_ID> --name <secret_name> -n <secret_namespace> --cert-crn <certificate_crn>
    ```
    {: pre}


3. List the Ingress secrets in your cluster. In the output, verify that the **Expires On** date for each secret is more than 5 days later than the current date.
    ```sh
    ibmcloud ks ingress secret ls -c <cluster_name_or_ID>
    ```
    {: pre}
    
    
    
